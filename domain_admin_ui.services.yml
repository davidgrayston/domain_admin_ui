services:
  domain_admin_ui.overrider:
    decorates: domain_config.overrider
    class: Drupal\domain_admin_ui\DomainAdminUIConfigOverrider
    tags:
      - { name: config.factory.override}
    arguments: ['@domain.negotiator', '@config.storage']

  domain_admin_ui.negotiator:
    decorates: domain.negotiator
    class: Drupal\domain_admin_ui\DomainAdminUINegotiator
    tags:
      - { name: persist }
    arguments: ['@request_stack', '@module_handler', '@domain.loader', '@config.factory']
    calls:
      - [setDomainConfigOverrider, ['@domain_config.overrider']]
      - [initSelectedLanguage]

  domain_admin_ui.factory:
    class: Drupal\domain_admin_ui\Config\ConfigFactory
    tags:
      - { name: event_subscriber }
      - { name: service_collector, tag: 'config.factory.override', call: addOverride }
    arguments: ['@config.storage', '@event_dispatcher', '@config.typed']
    calls:
      - [setDomainNegotiator, ['@domain.negotiator']]

  config.factory:
    alias: domain_admin_ui.factory
